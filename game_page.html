<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Escape Room</h1>
    <a href='index.html'> Home </a>
    <canvas id="myCanvas" width="200" height="100" style="border:1px solid #000000;"> Your browser does not support the HTML canvas tag. </canvas>


    <img id ="PlayerR" src = "playerR.png" style="display: none;">
    <img id ="PlayerL" src = "playerL.png" style="display: none;">

    <script>
        // Call loop
        setInterval (mainLoop, 60);

        // Canvas variables
        const c = document.getElementById("myCanvas");
        const ctx = c.getContext("2d");
        
        // Variables
        var Speed = 5;
        var playerSize = ctx.canvas.height/1;
        var floorHeight = ctx.canvas.height-ctx.canvas.height/10
        
        // Listeners
        window.addEventListener("keydown",function(event){ keySetter(event, true)  });
        window.addEventListener("keyup",function(event){ keySetter(event, false)  });
        
        //Player variables
        var player = 
        {
            X: 0, Y: 0, facingR: true, moved: false, isGround: false, imgR: document.getElementById("PlayerR"), imgL: document.getElementById("PlayerL")
        }


        

        function mainLoop()
        {
            // Set canvas width + height
            ctx.canvas.width  = window.innerWidth-10;
            ctx.canvas.height = window.innerHeight-125;
            
            // Debug
            console.log(player.facingR);
            //console.log(player.X + " " + player.Y);

            // Clear player
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

            // Draw new player 
            if(player.facingR == true) ctx.drawImage(player.imgR, player.X, player.Y, playerSize, playerSize);
            else ctx.drawImage(player.imgL, player.X, player.Y, playerSize, playerSize);

            // Call functions
            checkGround();
            gravity();
        }  

        function keySetter(key,value)
        {
            if(key.code == "KeyA" || key.code == "ArrowLeft")
            {
                key.preventDefault();
                player.X -= Speed;
                player.facingR = false;
                player.moved = true;
            }

            if(key.code == "KeyD" || key.code == "ArrowRight")
            {
                key.preventDefault();
                player.X += Speed;
                player.facingR = true;
                player.moved = true;
            }

            if(key.code == "KeyW" && player.isGround == true || key.code == "ArrowUp" && player.isGround == true)
            {
                jump();
                player.moved = true;                
            }

            player.moved = false;
        } 

        function drawImg(img, x, y)
        {
            ctx.drawImage(img, x, y);       
        }

        function drawRect(x, y, h, w)
        {
            ctx.beginPath();
            ctx.strokeStyle = '#000000';
            ctx.fillStyle = '#000000';
            Player = ctx.fillRect(x, y, h, w);
            ctx.stroke();
        }

        function jump()
        {
            player.Y -= 15;
            player.isGround = false;
        }

        function gravity()
        {
            if(player.isGround == false) player.Y += 25;
        }

        function checkGround()
        {
            if(player.Y >= floorHeight) isGround = true;
            else isGround = false;
            if(player.Y > 500) player.Y = 500;
        }
    </script>
</body>
</html>
