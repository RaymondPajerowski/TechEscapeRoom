<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game</title>
</head>
<body>
    <h1>Beautiful Game 10/10</h1>
    <a href='index.html'> Home </a>
    <canvas id="myCanvas" width="200" height="100" style="border:1px solid #000000;"> Your browser does not support the HTML canvas tag. </canvas>


    <img id ="PlayerR" src = "playerR.png" style="display: none;">
    <img id ="PlayerL" src = "playerL.png" style="display: none;">

    <script>
        // Call loop
        setInterval (mainLoop, 60);

        // Canvas variables
        const c = document.getElementById("myCanvas");
        const ctx = c.getContext("2d");
        
        // Variables
        var Speed = 5;
        var playerSize = ctx.canvas.height/1;
        var floorHeight;
        var distanceToGround;

        //var Height = ctx.canvas.height-ctx.canvas.height/10;
        
        // Listeners
        window.addEventListener("keydown",function(event){ keySetter(event, true)  });
        window.addEventListener("keyup",function(event){ keySetter(event, false)  });
        
        //Player variables
        var player = 
        {
            X: 0, Y: 0, newX:0, newY: 0, facingR: true, moved: false, isGround: false, imgR: document.getElementById("PlayerR"), imgL: document.getElementById("PlayerL")
        }

        var KeyStates = 
        {
            Left: false, Right: false, Jump: false
        }

        var ObjList = [];

        // Stages
        var stage = {one: true, two: false, three: false, four: false}
        

        function mainLoop()
        {
            // Set vars
            ctx.canvas.width  = window.innerWidth-10;
            ctx.canvas.height = window.innerHeight-125;

            floorHeight = ctx.canvas.height;
            distanceToGround = floorHeight - player.Y;

            

            
            // Debug

            // Clear player
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

            // Draw new player 
            if(player.facingR == true) ctx.drawImage(player.imgR, player.X, player.Y, playerSize, playerSize);
            else ctx.drawImage(player.imgL, player.X, player.Y, playerSize, playerSize);


            // Call functions
            checkGround();
            gravity();
            drawStage();
            movePlayer();

            // Add objects
            addObj(100,100,100,100,"#100000");
        }  

        function keySetter(key,value)
        {
            if(key.code == "KeyA" || key.code == "ArrowLeft")
            {
                KeyStates.Left = value;
            }

            if(key.code == "KeyD" || key.code == "ArrowRight")
            {
                KeyStates.Right = value;
            }

            if(key.code == "KeyW" || key.code == "ArrowUp" || key.code == "Space")
            {
                KeyStates.Jump = value;
            }
        } 

        function movePlayer()
        {
            // Left
            if(KeyStates.Left)
            {
                player.newX = player.X;
                player.newX -= Speed;
                for(let i = 0; i < ObjList.length; i++)
                {
                    if(player.newX + playerSize < ObjList[i].X && player.Y >= ObjList[i].Y || player.newX > ObjList[i].X + ObjList[i].Width && player.Y >= ObjList[i].Y)
                    {
                        player.X = player.newX;
                        player.facingR = false;
                    }
                }
            }

            // Right
            if(KeyStates.Right)
            {
                player.newX = player.X;
                player.newX += Speed;
                for(let i = 0; i < ObjList.length; i++)
                {     
                    if(player.newX + playerSize < ObjList[i].X && player.Y >= ObjList[i].Y || player.newX > ObjList[i].X + ObjList[i].Width && player.Y >= ObjList[i].Y)
                    {
                        player.X = player.newX;
                        player.facingR = true;
                    }
                }
            }

            // Jump
            if(KeyStates.Jump) jump();
        }

        function drawImg(img, x, y)
        {
            ctx.drawImage(img, x, y);       
        }

        function drawRect(x, y, h, w)
        {
            ctx.beginPath();
            ctx.strokeStyle = '#000000';
            ctx.fillStyle = '#000000';
            Player = ctx.fillRect(x, y, h, w);
            ctx.stroke();
        }

        function jump()
        {
            player.Y -= 15;
            player.isGround = false;
            for (let i = 0; i < 5; i++) 
            {
                player.Y -= 5;
            }
        }

        function gravity()
        {
            if(player.isGround == false) player.Y += 25; 
        }

        function checkGround()
        {
            if(player.Y >= floorHeight-playerSize) player.isGround = true;

            else player.isGround = false;
            
            if(player.Y >= floorHeight-playerSize) player.Y = floorHeight-playerSize;
        }

        function addObj(x, y, width, height, color)
        {
            newObj = {X: x, Y: y, Width: width, Height: height, Color: color};

            ObjList.push(newObj);
        }


        function drawStage()
        {
            // Draw stage
            if(stage.one == true)
            {
                
            }

            else if(stage.two == true) 
            {

            }

            else if(stage.three == true) 
            {

            }

            else 
            {

            }
        }
    </script>
</body>
</html>