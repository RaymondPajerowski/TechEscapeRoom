<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game</title>
</head>
<body>
    <h1>Escape Room</h1>
    <a href='index.html'> Home </a>
    <canvas id="myCanvas" width="200" height="100" style="border:1px solid #000000;"> Your browser does not support the HTML canvas tag. </canvas>


    <img id ="PlayerR" src = "playerR.png" style="display: none;">
    <img id ="PlayerL" src = "playerL.png" style="display: none;">

    <script>
        // Call loop
        setInterval (mainLoop, 60);

        // Canvas variables
        const c = document.getElementById("myCanvas");
        const ctx = c.getContext("2d");
        
        // Variables
        var Speed = 5;
        var playerSize = ctx.canvas.height/1;
        var floorHeight;
        //var Height = ctx.canvas.height-ctx.canvas.height/10;
        
        // Listeners
        window.addEventListener("keydown",function(event){ keySetter(event, true)  });
        window.addEventListener("keyup",function(event){ keySetter(event, false)  });
        
        //Player variables
        var player = 
        {
            X: 0, Y: 0, facingR: true, moved: false, isGround: false, imgR: document.getElementById("PlayerR"), imgL: document.getElementById("PlayerL")
        }

        // Stages
        var stage = {one: true, two: false, three: false, four: false}
        

        function mainLoop()
        {
            // Set canvas width + height
            ctx.canvas.width  = window.innerWidth-10;
            ctx.canvas.height = window.innerHeight-125;

            floorHeight = ctx.canvas.height-playerSize;

            
            // Debug


            // Clear player
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

            // Draw new player 
            if(player.facingR == true) ctx.drawImage(player.imgR, player.X, player.Y, playerSize, playerSize);
            else ctx.drawImage(player.imgL, player.X, player.Y, playerSize, playerSize);


            // Call functions
            checkGround();
            gravity();
            drawStage();
        }  

        function keySetter(key,value)
        {
            if(key.code == "KeyA" && player.X > 0|| key.code == "ArrowLeft" && player.X > 0)
            {
                key.preventDefault();
                player.X -= Speed;
                player.facingR = false;
                player.moved = true;
            }

            if(player.X < 0) player.X = 0;

            if(key.code == "KeyD" && player.X < ctx.canvas.width-playerSize || key.code == "ArrowRight" && player.X < ctx.canvas.width-playerSize)
            {
                key.preventDefault();
                player.X += Speed;
                player.facingR = true;
                player.moved = true;
            }

            if(player.X > ctx.canvas.width-playerSize) player.X = ctx.canvas.width-playerSize;

            if(key.code == "KeyW" && player.isGround == true || key.code == "ArrowUp" && player.isGround == true)
            {
                jump();
                player.moved = true;                
            }

            player.moved = false;
        } 

        function drawImg(img, x, y)
        {
            ctx.drawImage(img, x, y);       
        }

        function drawRect(x, y, h, w)
        {
            ctx.beginPath();
            ctx.strokeStyle = '#000000';
            ctx.fillStyle = '#000000';
            Player = ctx.fillRect(x, y, h, w);
            ctx.stroke();
        }

        function jump()
        {
            player.Y -= 15;
            //player.isGround = false;
            for (let i = 0; i < 5; i++) 
            {
                player.Y -= 5;
            }
        }

        function gravity()
        {
            //if(player.isGround == false) 
            player.Y += 25; 
        }

        function checkGround()
        {
            if(player.Y >= floorHeight) player.isGround = true;

            else player.isGround = false;
            
            if(player.Y >= floorHeight) player.Y = floorHeight;
        }

        function move()
        {

        }

        function drawStage()
        {
            // Draw stage
            if(stage.one == true)
            {
                ctx.beginPath();
                ctx.strokeStyle = '#26580F';
                ctx.fillStyle = '#26580F';
                ctx.fillRect(50, ctx.canvas.width/2, ctx.canvas.width/2, ctx.canvas.height/10);
                ctx.stroke();
            }

            else if(stage.two == true) 
            {

            }

            else if(stage.three == true) 
            {

            }

            else 
            {

            }
        }
    </script>
</body>
</html>
