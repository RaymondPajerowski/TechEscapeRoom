<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game</title>
</head>
<body>
    <h1>Beautiful Game 10/10</h1>
    <a href='index.html'> Home </a>
    <canvas id="myCanvas" width="200" height="100" style="border:1px solid #000000;"> Your browser does not support the HTML canvas tag. </canvas>


    <img id ="PlayerR" src = "playerR.png" style="display: none;">
    <img id ="PlayerL" src = "playerL.png" style="display: none;">

    <script>
        // Call loop
        setInterval (mainLoop, 60);

        // Canvas variables
        const c = document.getElementById("myCanvas");
        const ctx = c.getContext("2d");
        
        // Variables
        var Speed = 5;
        var playerSize = ctx.canvas.height/1;
        var floorHeight;
        var distanceToGround;
        var jumpHeight = ctx.canvas.height.20

        //var Height = ctx.canvas.height-ctx.canvas.height/10;
        
        // Listeners
        window.addEventListener("keydown",function(event){ keySetter(event, true)  });
        window.addEventListener("keyup",function(event){ keySetter(event, false)  });
        
        //Player variables
        var player = 
        {
            X: 0, Y: 0, newX:0, newY: 0, facingR: true, moved: false, isGround: false, imgR: document.getElementById("PlayerR"), imgL: document.getElementById("PlayerL")
        }

        var KeyStates = 
        {
            Left: false, Right: false, Jump: false
        }

        var ObjList = [];

        // Stages
        var stage = {one: true, two: false, three: false, four: false}
        

        function mainLoop()
        {
            // Set vars
            ctx.canvas.width  = window.innerWidth-10;
            ctx.canvas.height = window.innerHeight-125;

            floorHeight = ctx.canvas.height;
            distanceToGround = floorHeight - player.Y
            
            // Debug

            
            // Clear player
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

            // Draw new player 
            if(player.facingR == true) ctx.drawImage(player.imgR, player.X, player.Y, playerSize, playerSize);
            else ctx.drawImage(player.imgL, player.X, player.Y, playerSize, playerSize);


            // Call functions
            checkGround();
            gravity();
            drawStage();
            movePlayer();
        }  

        function keySetter(key,value)
        {
            if(key.code == "KeyA" || key.code == "ArrowLeft")
            {
                KeyStates.Left = value;
            }

            if(key.code == "KeyD" || key.code == "ArrowRight")
            {
                KeyStates.Right = value;
            }

            if(key.code == "KeyW" || key.code == "ArrowUp" || key.code == "Space")
            {
                KeyStates.Jump = value;
            }
        } 

        function movePlayer()
        {
            // Left
            if(KeyStates.Left || KeyStates.Right)
            {
                player.newX = player.X;
                if(KeyStates.Left) player.newX -= Speed;
                if(KeyStates.Right) player.newX += Speed;
                for(let i = 0; i < ObjList.length; i++)
                {
                    if(player.newX + playerSize < ObjList[i].X || player.newX > ObjList[i].X + ObjList[i].Width)
                    {
                        player.X = player.newX;
                        if(KeyStates.Left) player.facingR = false;
                        else if(KeyStates.Right) player.facingR = true;
                        console.log("urmom");
                    }

                    else if(player.Y >= ObjList[i].Y + ObjList[i].Height || player.Y + playerSize <= ObjList[i].Y)
                    {
                        player.X = player.newX;
                        if(KeyStates.Left) player.facingR = false;
                        else  if(KeyStates.Right) player.facingR = true;
                        console.log("tumama");
                    }
                }
            }

           
            // Jump
            if(KeyStates.Jump && player.isGround == true)
            {
                player.isGround = false;

                for (let i = 0; i < 25; i++) 
                {
                    player.newY = player.Y;
                    player.newY -= jumpHeight;
                    for(let i = 0; i < ObjList.length; i++)
                    {
                        if(player.newY > ObjList[i].Y + ObjList[i].Height) player.Y = player.newY
                        else if(player.X < ObjList[i].X || player.X > ObjList[i].X + ObjList[i].Width) player.Y = player.newY
                    }
                    setTimeout(250);
                }
            }
        }

        function drawImg(img, x, y)
        {
            ctx.drawImage(img, x, y);       
        }

        function drawRect(x, y, h, w, c)
        {
            ctx.beginPath();
            ctx.strokeStyle = c;
            ctx.fillStyle = c;
            Player = ctx.fillRect(x, y, h, w);
            ctx.stroke();
        }

        function gravity()
        {
            player.newY = player.Y;
            if(player.isGround == false) player.newY += 25; 
            for(let i = 0; i < ObjList.length; i++)
            {
                if(player.newY + playerSize <= ObjList[i].Y) player.Y = player.newY
                //else if(player.X + playerSize < ObjList[i].X || player.X > ObjList[i].X + ObjList[i].Width) player.Y = player.newY
            }
        }

        function checkGround()
        {
            if(player.Y >= floorHeight-playerSize) player.isGround = true;

            else player.isGround = false;
            
            if(player.Y >= floorHeight-playerSize) player.Y = floorHeight-playerSize;
        }

        function addObj(x, y, width, height, color)
        {
            newObj = {X: x, Y: y, Width: width, Height: height, Color: color};

            ObjList.push(newObj);
        }

        function drawObj()
        {
            for(let i = 0; i < ObjList.length; i++)
            {
                drawRect(ObjList[i].X, ObjList[i].Y, ObjList[i].Width, ObjList[i].Height, ObjList[i].Color);
            }
        }


        function drawStage()
        {
            // Draw stage
            if(stage.one == true)
            {
                ObjList.length = 0;
                addObj(ctx.canvas.width/2, ctx.canvas.height-ctx.canvas.height/10, ctx.canvas.width/2, ctx.canvas.height/10, '#32CD32');
                drawObj();
            }

            else if(stage.two == true) 
            {

            }

            else if(stage.three == true) 
            {

            }

            else 
            {

            }
        }
    </script>
</body>
</html>
